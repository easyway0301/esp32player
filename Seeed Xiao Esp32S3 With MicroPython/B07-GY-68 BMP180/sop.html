<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>BMP180 æ°£å£“æ„Ÿæ¸¬å™¨ï½œMicroPython SOP</title>
<style>
    body {
        font-family: Arial, "Microsoft JhengHei", sans-serif;
        line-height: 1.9;
        max-width: 980px;
        margin: 40px auto;
        padding: 0 20px;
        color: #222;
        background-color: #f5f7fa;
    }

    h1 {
        text-align: center;
        margin-bottom: 10px;
    }

    .subtitle {
        text-align: center;
        color: #555;
        margin-bottom: 50px;
    }

    section {
        background: #ffffff;
        border-radius: 14px;
        padding: 40px;
        margin-bottom: 50px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }

    h2 {
        margin-top: 0;
        border-left: 6px solid #4CAF50;
        padding-left: 14px;
    }

    p {
        margin: 14px 0;
    }

    ul {
        margin-left: 22px;
    }

    img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 28px auto 10px;
        border-radius: 12px;
        box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }

    .highlight {
        background: #e8f5e9;
        border-left: 6px solid #4caf50;
        padding: 16px 20px;
        border-radius: 8px;
        margin: 20px 0;
        font-size: 16px;
    }

    /* Code block */
    .code-block {
        position: relative;
        background: #0d1117;
        color: #c9d1d9;
        border-radius: 12px;
        padding: 20px;
        margin: 30px 0;
        font-family: Consolas, Monaco, monospace;
        font-size: 14px;
        overflow-x: auto;
    }

    .code-block pre {
        margin: 0;
        white-space: pre;
    }

    .copy-btn {
        position: absolute;
        top: 12px;
        right: 12px;
        background: #238636;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 6px 14px;
        cursor: pointer;
        font-size: 13px;
    }

    .copy-btn:hover {
        background: #2ea043;
    }
</style>
</head>
<body>

<h1>ğŸ“˜ BMP180 æ°£å£“æ„Ÿæ¸¬å™¨ SOPï¼ˆMicroPythonï¼‰</h1>

<p>
æœ¬æ•™å­¸ç¤ºç¯„å¦‚ä½•ä½¿ç”¨ <b>BMP180 æ°£å£“æ„Ÿæ¸¬å™¨</b> æ­é…
<b>Seeed XIAO ESP32-S3</b>ï¼Œé€é <b>I2C</b> è®€å–ï¼š
</p>

<ul>
    <li>ğŸŒ¡ æº«åº¦ï¼ˆÂ°Cï¼‰</li>
    <li>ğŸŒ¬ æ°£å£“ï¼ˆPaï¼‰</li>
    <li>â›° é«˜åº¦ï¼ˆmï¼‰</li>
</ul>

<p>æœ¬ç¯„ä¾‹<strong>åªåŸ·è¡Œä¸€æ¬¡é‡æ¸¬</strong>ï¼Œä¸ä½¿ç”¨ while è¿´åœˆã€‚</p>

<hr>

<h2>ğŸ”Œ ä¸€ã€æ¥ç·šæ–¹å¼</h2>

<ul>
    <li>VCC â†’ 3V3</li>
    <li>GND â†’ GND</li>
    <li>SCL â†’ GPIO6</li>
    <li>SDA â†’ GPIO5</li>
</ul>

<hr>

<h2>ğŸ“¦ äºŒã€I2C åˆå§‹åŒ–</h2>

<pre><code>
from machine import I2C, Pin
import time
import ustruct

# åˆå§‹åŒ– I2Cï¼ˆI2C1ï¼‰
i2c = I2C(1, scl=Pin(6), sda=Pin(5), freq=100000)

# æƒæ I2C è£ç½®
print(i2c.scan())
</code></pre>

<hr>

<h2>âš™ ä¸‰ã€è®€å–æ ¡æ­£è³‡æ–™</h2>

<pre><code>
BMP180_ADDR = 0x77  # BMP180 I2C ä½å€

def read_calibration():
    # å¾ 0xAA è®€å– 22 bytes æ ¡æ­£è³‡æ–™
    calib = i2c.readfrom_mem(BMP180_ADDR, 0xAA, 22)
    return ustruct.unpack("&gt;hhhHHhhhhhh", calib)

AC1, AC2, AC3, AC4, AC5, AC6, B1, B2, MB, MC, MD = read_calibration()
</code></pre>

<hr>

<h2>ğŸŒ¡ å››ã€æº«åº¦è®€å–èˆ‡è¨ˆç®—</h2>

<pre><code>
def read_raw_temp():
    # ç™¼é€æº«åº¦é‡æ¸¬æŒ‡ä»¤
    i2c.writeto_mem(BMP180_ADDR, 0xF4, b'\x2E')
    time.sleep_ms(5)

    # è®€å–åŸå§‹æº«åº¦
    raw = i2c.readfrom_mem(BMP180_ADDR, 0xF6, 2)
    return ustruct.unpack("&gt;H", raw)[0]

def get_temperature():
    UT = read_raw_temp()
    X1 = ((UT - AC6) * AC5) &gt;&gt; 15
    X2 = (MC &lt;&lt; 11) // (X1 + MD)
    B5 = X1 + X2
    T = (B5 + 8) &gt;&gt; 4
    return T / 10, B5
</code></pre>

<hr>

<h2>ğŸŒ¬ äº”ã€æ°£å£“è®€å–èˆ‡è¨ˆç®—</h2>

<pre><code>
def read_raw_pressure(oss=0):
    i2c.writeto_mem(BMP180_ADDR, 0xF4, bytes([0x34 + (oss &lt;&lt; 6)]))
    time.sleep_ms(2 + 3 * (1 &lt;&lt; oss))

    msb = i2c.readfrom_mem(BMP180_ADDR, 0xF6, 1)[0]
    lsb = i2c.readfrom_mem(BMP180_ADDR, 0xF7, 1)[0]
    xlsb = i2c.readfrom_mem(BMP180_ADDR, 0xF8, 1)[0]

    return ((msb &lt;&lt; 16) + (lsb &lt;&lt; 8) + xlsb) &gt;&gt; (8 - oss)

def get_pressure():
    oss = 0
    temperature, B5 = get_temperature()
    UP = read_raw_pressure(oss)

    B6 = B5 - 4000
    X1 = (B2 * (B6 * B6 &gt;&gt; 12)) &gt;&gt; 11
    X2 = (AC2 * B6) &gt;&gt; 11
    X3 = X1 + X2
    B3 = (((AC1 * 4 + X3) &lt;&lt; oss) + 2) &gt;&gt; 2

    X1 = (AC3 * B6) &gt;&gt; 13
    X2 = (B1 * ((B6 * B6) &gt;&gt; 12)) &gt;&gt; 16
    X3 = ((X1 + X2) + 2) &gt;&gt; 2
    B4 = (AC4 * (X3 + 32768)) &gt;&gt; 15
    B7 = (UP - B3) * (50000 &gt;&gt; oss)

    if B7 &lt; 0x80000000:
        p = (B7 * 2) // B4
    else:
        p = (B7 // B4) * 2

    X1 = (p &gt;&gt; 8) * (p &gt;&gt; 8)
    X1 = (X1 * 3038) &gt;&gt; 16
    X2 = (-7357 * p) &gt;&gt; 16

    return p + ((X1 + X2 + 3791) &gt;&gt; 4)
</code></pre>

<hr>

<h2>â›° å…­ã€é«˜åº¦è¨ˆç®—</h2>

<pre><code>
def get_altitude(p, p0=101325):
    # ä¾æ¨™æº–å¤§æ°£å£“è¨ˆç®—é«˜åº¦
    return 44330 * (1 - (p / p0) ** (1 / 5.255))
</code></pre>

<hr>

<h2>â–¶ ä¸ƒã€åŸ·è¡Œä¸€æ¬¡é‡æ¸¬</h2>

<pre><code>
temperature, _ = get_temperature()
pressure = get_pressure()
altitude = get_altitude(pressure)

print("æº«åº¦:", temperature, "Â°C")
print("æ°£å£“:", pressure, "Pa")
print("é«˜åº¦:", altitude, "m")
</code></pre>

<hr>

<h2>âœ… å…«ã€åŸ·è¡Œçµæœ</h2>

<ul>
    <li>é¡¯ç¤ºç›®å‰æº«åº¦ï¼ˆÂ°Cï¼‰</li>
    <li>é¡¯ç¤ºæ°£å£“ï¼ˆPaï¼‰</li>
    <li>æ¨ç®—é«˜åº¦ï¼ˆå…¬å°ºï¼‰</li>
</ul>

<p><b>æœ¬ç¯„ä¾‹ä¸ä½¿ç”¨ while è¿´åœˆï¼Œé©åˆæ¸¬è©¦èˆ‡æ•™å­¸ã€‚</b></p>

</body>
</html>
