<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>BMP180 æ°£å£“æ„Ÿæ¸¬æ¨¡çµ„ï½œESP32-S3 MicroPython SOP</title>

<style>
body {
    font-family: Arial, "Microsoft JhengHei", sans-serif;
    background: #f5f7fa;
    color: #222;
    line-height: 1.9;
    max-width: 980px;
    margin: 40px auto;
    padding: 0 20px;
}

h1 {
    text-align: center;
    margin-bottom: 10px;
}

.subtitle {
    text-align: center;
    color: #555;
    margin-bottom: 50px;
}

section {
    background: #ffffff;
    border-radius: 14px;
    padding: 40px;
    margin-bottom: 50px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}

h2 {
    margin-top: 0;
    border-left: 6px solid #2196F3;
    padding-left: 14px;
}

.code-block {
    background: #0d1117;
    color: #c9d1d9;
    border-radius: 12px;
    padding: 20px;
    margin: 30px 0;
    font-family: Consolas, monospace;
    font-size: 14px;
    overflow-x: auto;
}

pre {
    margin: 0;
}

.highlight {
    background: #e3f2fd;
    border-left: 6px solid #2196f3;
    padding: 16px 20px;
    border-radius: 8px;
    margin: 20px 0;
}
</style>
</head>

<body>

<h1>BMP180 æ°£å£“æ„Ÿæ¸¬æ¨¡çµ„</h1>
<div class="subtitle">ESP32-S3 Ã— MicroPython SOP æ•™å­¸</div>

<section>
<h2>æ¨¡çµ„ä»‹ç´¹</h2>

<p>
BMP180 æ˜¯ä¸€æ¬¾å¸¸è¦‹çš„ <strong>æ•¸ä½æ°£å£“èˆ‡æº«åº¦æ„Ÿæ¸¬æ¨¡çµ„</strong>ï¼Œ
å¯é€éæ°£å£“è®ŠåŒ–æ¨ç®—é«˜åº¦ï¼Œå¸¸ç”¨æ–¼å¤©æ°£ç«™èˆ‡é«˜åº¦é‡æ¸¬ã€‚
</p>

<div class="highlight">
<strong>æ¨¡çµ„ç‰¹æ€§ï¼š</strong><br>
â€¢ é€šè¨Šä»‹é¢ï¼šI2C<br>
â€¢ æ°£å£“ç¯„åœï¼š300 ~ 1100 hPa<br>
â€¢ å…§å»ºæº«åº¦è£œå„Ÿ<br>
â€¢ å¸¸è¦‹ I2C ä½å€ï¼š0x77
</div>
</section>

<section>
<h2>æ¥ç·šæ–¹å¼ï¼ˆSeeed XIAO ESP32-S3ï¼‰</h2>

<ul>
    <li>VCC â†’ 3V3</li>
    <li>GND â†’ GND</li>
    <li>SDA â†’ GPIO 5</li>
    <li>SCL â†’ GPIO 6</li>
</ul>

<div class="highlight">
ğŸ“Œ BMP180 ä½¿ç”¨ I2Cï¼Œä¸éœ€è¦é¡å¤–é›»é˜»ã€‚
</div>
</section>

<section>
<h2>MicroPython ç¨‹å¼ç¢¼ï¼ˆå–®æ¬¡æ¸¬é‡ï¼‰</h2>

<p>
ä»¥ä¸‹ç¨‹å¼ç¢¼<strong>ä¸ä½¿ç”¨ while è¿´åœˆ</strong>ï¼Œ
ä¸Šé›»å¾Œåªæœƒæ¸¬é‡ä¸€æ¬¡æº«åº¦ã€æ°£å£“èˆ‡é«˜åº¦ã€‚
</p>

<div class="code-block">
<pre><code>
from machine import I2C, Pin
import time
import ustruct

# === åˆå§‹åŒ– I2C ===
i2c = I2C(1, scl=Pin(6), sda=Pin(5), freq=100000)

# BMP180 I2C ä½å€
BMP180_ADDR = 0x77

# === è®€å–æ ¡æ­£è³‡æ–™ ===
def read_calibration():
    data = i2c.readfrom_mem(BMP180_ADDR, 0xAA, 22)
    return ustruct.unpack(">hhhHHhhhhhh", data)

AC1, AC2, AC3, AC4, AC5, AC6, B1, B2, MB, MC, MD = read_calibration()

# === è®€å–åŸå§‹æº«åº¦ ===
def read_raw_temp():
    i2c.writeto_mem(BMP180_ADDR, 0xF4, b'\x2E')
    time.sleep_ms(5)
    raw = i2c.readfrom_mem(BMP180_ADDR, 0xF6, 2)
    return ustruct.unpack(">H", raw)[0]

# === è®€å–åŸå§‹æ°£å£“ ===
def read_raw_pressure():
    i2c.writeto_mem(BMP180_ADDR, 0xF4, b'\x34')
    time.sleep_ms(8)
    msb = i2c.readfrom_mem(BMP180_ADDR, 0xF6, 1)[0]
    lsb = i2c.readfrom_mem(BMP180_ADDR, 0xF7, 1)[0]
    xlsb = i2c.readfrom_mem(BMP180_ADDR, 0xF8, 1)[0]
    return ((msb << 16) + (lsb << 8) + xlsb) >> 8

# === è¨ˆç®—æº«åº¦ ===
UT = read_raw_temp()
X1 = ((UT - AC6) * AC5) >> 15
X2 = (MC << 11) // (X1 + MD)
B5 = X1 + X2
temperature = ((B5 + 8) >> 4) / 10

# === è¨ˆç®—æ°£å£“ ===
UP = read_raw_pressure()
B6 = B5 - 4000
X1 = (B2 * (B6 * B6 >> 12)) >> 11
X2 = (AC2 * B6) >> 11
X3 = X1 + X2
B3 = ((AC1 * 4 + X3) + 2) >> 2
X1 = (AC3 * B6) >> 13
X2 = (B1 * ((B6 * B6) >> 12)) >> 16
X3 = (X1 + X2 + 2) >> 2
B4 = (AC4 * (X3 + 32768)) >> 15
B7 = (UP - B3) * 50000

if B7 < 0x80000000:
    pressure = (B7 * 2) // B4
else:
    pressure = (B7 // B4) * 2

# === è¨ˆç®—é«˜åº¦ ===
altitude = 44330 * (1 - (pressure / 101325) ** (1 / 5.255))

print("æº«åº¦:", temperature, "Â°C")
print("æ°£å£“:", pressure, "Pa")
print("é«˜åº¦:", altitude, "m")
</code></pre>
</div>
</section>

<section>
<h2>åŸ·è¡Œçµæœ</h2>

<ul>
    <li>åºåˆ—åŸ é¡¯ç¤ºæº«åº¦ï¼ˆÂ°Cï¼‰</li>
    <li>é¡¯ç¤ºæ°£å£“ï¼ˆPaï¼‰</li>
    <li>ä¾æ¨™æº–æ°£å£“æ¨ç®—é«˜åº¦ï¼ˆmï¼‰</li>
</ul>

<div class="highlight">
ğŸ“Œ è‹¥é«˜åº¦ä¸æº–ï¼Œè«‹ä¾å¯¦éš›åœ°å€æ°£å£“èª¿æ•´åŸºæº–å€¼ã€‚
</div>
</section>

</body>
</html>
